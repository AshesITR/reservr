<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a neural network based distribution model to data — fit.reservr_keras_model • reservr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit a neural network based distribution model to data — fit.reservr_keras_model" />
<meta property="og:description" content="This function delegates most work to keras::fit.keras.engine.training.Model() and performs additional consistency
checks to make sure tf_compile_model() was called with the appropriate options to support fitting the observations
y as well as automatically converting y to a n x 6 matrix needed by the compiled loss function." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reservr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/distributions.html">Working with Distributions</a>
    </li>
    <li>
      <a href="../articles/tensorflow.html">TensorFlow Integration</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/AshesITR/reservr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a neural network based distribution model to data</h1>
    <small class="dont-index">Source: <a href='https://github.com/AshesITR/reservr/blob/master/R/tf_fit.R'><code>R/tf_fit.R</code></a></small>
    <div class="hidden name"><code>fit.reservr_keras_model.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function delegates most work to <code><a href='https://keras.rstudio.com/reference/fit.keras.engine.training.Model.html'>keras::fit.keras.engine.training.Model()</a></code> and performs additional consistency
checks to make sure <code><a href='tf_compile_model.html'>tf_compile_model()</a></code> was called with the appropriate options to support fitting the observations
<code>y</code> as well as automatically converting <code>y</code> to a n x 6 matrix needed by the compiled loss function.</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for reservr_keras_model</span>
<span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span>
  <span class='va'>object</span>,
  <span class='va'>x</span>,
  <span class='va'>y</span>,
  batch_size <span class='op'>=</span> <span class='cn'>NULL</span>,
  epochs <span class='op'>=</span> <span class='fl'>10</span>,
  verbose <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"keras.fit_verbose"</span>, default <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>,
  callbacks <span class='op'>=</span> <span class='cn'>NULL</span>,
  view_metrics <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"keras.view_metrics"</span>, default <span class='op'>=</span> <span class='st'>"auto"</span><span class='op'>)</span>,
  validation_split <span class='op'>=</span> <span class='fl'>0</span>,
  validation_data <span class='op'>=</span> <span class='cn'>NULL</span>,
  shuffle <span class='op'>=</span> <span class='cn'>TRUE</span>,
  class_weight <span class='op'>=</span> <span class='cn'>NULL</span>,
  sample_weight <span class='op'>=</span> <span class='cn'>NULL</span>,
  initial_epoch <span class='op'>=</span> <span class='fl'>0</span>,
  steps_per_epoch <span class='op'>=</span> <span class='cn'>NULL</span>,
  validation_steps <span class='op'>=</span> <span class='cn'>NULL</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>A compiled <code>reservr_keras_model</code> as obtained by <code><a href='tf_compile_model.html'>tf_compile_model()</a></code>.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A list of input tensors (predictors)</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>A <code>trunc_obs</code> tibble of observed outcomes, or something convertible via <code><a href='trunc_obs.html'>as_trunc_obs()</a></code>.</p></td>
    </tr>
    <tr>
      <th>batch_size</th>
      <td><p>Integer or <code>NULL</code>. Number of samples per gradient update.
If unspecified, <code>batch_size</code> will default to 32.</p></td>
    </tr>
    <tr>
      <th>epochs</th>
      <td><p>Number of epochs to train the model.
Note that in conjunction with <code>initial_epoch</code>,
<code>epochs</code> is to be understood as "final epoch". The model is
not trained for a number of iterations given by <code>epochs</code>, but
merely until the epoch of index <code>epochs</code> is reached.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Verbosity mode (0 = silent, 1 = progress bar, 2 = one line per
epoch).</p></td>
    </tr>
    <tr>
      <th>callbacks</th>
      <td><p>List of callbacks to be called during training.</p></td>
    </tr>
    <tr>
      <th>view_metrics</th>
      <td><p>View realtime plot of training metrics (by epoch). The
default (<code>"auto"</code>) will display the plot when running within RStudio,
<code>metrics</code> were specified during model <code><a href='https://generics.r-lib.org/reference/compile.html'>compile()</a></code>, <code>epochs &gt; 1</code> and
<code>verbose &gt; 0</code>. Use the global <code>keras.view_metrics</code> option to establish a
different default.</p></td>
    </tr>
    <tr>
      <th>validation_split</th>
      <td><p>Float between 0 and 1. Fraction of the training data
to be used as validation data. The model will set apart this fraction of
the training data, will not train on it, and will evaluate the loss and any
model metrics on this data at the end of each epoch. The validation data
is selected from the last samples in the <code>x</code> and <code>y</code> data provided,
before shuffling.</p></td>
    </tr>
    <tr>
      <th>validation_data</th>
      <td><p>Data on which to evaluate the loss and any model
metrics at the end of each epoch. The model will not be trained on this
data. This could be a list (x_val, y_val) or a list (x_val, y_val,
val_sample_weights). <code>validation_data</code> will override <code>validation_split</code>.</p></td>
    </tr>
    <tr>
      <th>shuffle</th>
      <td><p>shuffle: Logical (whether to shuffle the training data
before each epoch) or string (for "batch"). "batch" is a special option
for dealing with the limitations of HDF5 data; it shuffles in batch-sized
chunks. Has no effect when <code>steps_per_epoch</code> is not <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>class_weight</th>
      <td><p>Optional named list mapping indices (integers) to a
weight (float) value, used for weighting the loss function
(during training only). This can be useful to tell the model to
"pay more attention" to samples from an under-represented class.</p></td>
    </tr>
    <tr>
      <th>sample_weight</th>
      <td><p>Optional array of the same length as x, containing
weights to apply to the model's loss for each sample. In the case of
temporal data, you can pass a 2D array with shape (samples,
sequence_length), to apply a different weight to every timestep of every
sample. In this case you should make sure to specify
<code>sample_weight_mode="temporal"</code> in <code><a href='https://generics.r-lib.org/reference/compile.html'>compile()</a></code>.</p></td>
    </tr>
    <tr>
      <th>initial_epoch</th>
      <td><p>Integer, Epoch at which to start training (useful for
resuming a previous training run).</p></td>
    </tr>
    <tr>
      <th>steps_per_epoch</th>
      <td><p>Total number of steps (batches of samples) before
declaring one epoch finished and starting the next epoch. When training
with input tensors such as TensorFlow data tensors, the default <code>NULL</code> is
equal to the number of samples in your dataset divided by the batch
size, or 1 if that cannot be determined.</p></td>
    </tr>
    <tr>
      <th>validation_steps</th>
      <td><p>Only relevant if <code>steps_per_epoch</code> is specified.
Total number of steps (batches of samples) to validate before stopping.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Unused. If old arguments are supplied, an error message will be raised informing how to fix the issue.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>history</code> object that contains all information collected during training.
The model object will be updated in-place as a side-effect.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Additionally, the default <code>batch_size</code> is <code><a href='https://rdrr.io/r/base/Extremes.html'>min(nrow(y), 10000)</a></code> instead of keras default of <code>32</code> because the latter
is a very bad choice for fitting most distributions since the involved loss is much less stable than typical losses
used in machine learning, leading to divergence for small batch sizes.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>predict.reservr_keras_model tf_compile_model keras::fit.keras.engine.training.Model</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>dist</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dist_exponential.html'>dist_exponential</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>params</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>rate <span class='op'>=</span> <span class='fl'>1.0</span><span class='op'>)</span>
<span class='va'>N</span> <span class='op'>&lt;-</span> <span class='fl'>100L</span>
<span class='va'>rand_input</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span>
<span class='va'>x</span> <span class='op'>&lt;-</span> <span class='va'>dist</span><span class='op'>$</span><span class='fu'>sample</span><span class='op'>(</span><span class='va'>N</span>, with_params <span class='op'>=</span> <span class='va'>params</span><span class='op'>)</span>

<span class='va'>tf_in</span> <span class='op'>&lt;-</span> <span class='fu'>keras</span><span class='fu'>::</span><span class='fu'><a href='https://keras.rstudio.com/reference/layer_input.html'>layer_input</a></span><span class='op'>(</span><span class='fl'>1L</span><span class='op'>)</span>
<span class='va'>mod</span> <span class='op'>&lt;-</span> <span class='fu'><a href='tf_compile_model.html'>tf_compile_model</a></span><span class='op'>(</span>
  inputs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>tf_in</span><span class='op'>)</span>,
  intermediate_output <span class='op'>=</span> <span class='va'>tf_in</span>,
  dist <span class='op'>=</span> <span class='va'>dist</span>,
  optimizer <span class='op'>=</span> <span class='fu'>keras</span><span class='fu'>::</span><span class='fu'><a href='https://keras.rstudio.com/reference/optimizer_adam.html'>optimizer_adam</a></span><span class='op'>(</span><span class='op'>)</span>,
  censoring <span class='op'>=</span> <span class='cn'>FALSE</span>,
  truncation <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='va'>tf_fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span>
  object <span class='op'>=</span> <span class='va'>mod</span>,
  x <span class='op'>=</span> <span class='fu'><a href='k_matrix.html'>k_matrix</a></span><span class='op'>(</span><span class='va'>rand_input</span><span class='op'>)</span>,
  y <span class='op'>=</span> <span class='va'>x</span>,
  epochs <span class='op'>=</span> <span class='fl'>10L</span>,
  callbacks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='fu'><a href='callback_debug_dist_gradients.html'>callback_debug_dist_gradients</a></span><span class='op'>(</span><span class='va'>mod</span>, <span class='fu'><a href='k_matrix.html'>k_matrix</a></span><span class='op'>(</span><span class='va'>rand_input</span><span class='op'>)</span>, <span class='va'>x</span>, keep_grads <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alexander Rosenstock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


